{# This file is part of SGS-Flask.

   SGS-Flask is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.
 
   SGS-Flask is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
 
   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
 
   Copyright Swallowtail Garden Seeds, Inc 
#}
{% extends "includes/base.html" %}
{# HTML within blocks should be indented as follows for consistency: #}
{# block head: 2 indentations of 2 spaces each. (4 spaces total.) #}
{# block main: 3 indentations of 2 spaces each. (6 spaces total.) #}
{% from 'includes/cultivar_box.html' import cultivar_box with context %}
{% block head %}
    <title>{{ cn.header }}</title>
    <link rel="canonical" href="{{ url_for('seeds.common_name', idx_slug=cn.index.slug, cn_slug=cn.slug, _external=True) }}">
{% endblock %}
{% block main %}
      <div class="header cn-header">
        <h1>{{ cn.header }}</h1>
        {% if cn.synonyms %}
        <h2 class="synomyms">{{ cn.synonyms_string }}</h2>
        {% endif %}
        {% if cn.botanical_names %}
        <h3 class="botanical-names">{{ cn.html_botanical_names|safe }}</h3>
        {% endif %}
        {% if cn.description %}
        <div class="description">{{ cn.description|safe }}</div>
        {% endif %}
        {% if cn.instructions %}
        <a class="to-planting-instructions" href="#{{ cn.slug }}-instructions">How to plant {{ cn.name }} seeds</a>
        {% endif %}
      </div>
      {% if subtypes or series %}
      <div class="onpage-nav">
        {% if subtypes %}
        <ul class="cn-subtypes">
          {% for st in subtypes %}
            {% if st.has_public_cultivars or current_user.can(Permission.MANAGE_SEEDS) %}
          <li>
            <a href="#subtype-{{ st.slug }}">{{ st.name }}</a>
          </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}
        {% if series %}
        <ul class="cn-series">
          {% for sr in series %}
            {% if sr.has_public_cultivars or current_user.can(Permission.MANAGE_SEEDS) %}
          <li>
            <a href="#series-{{ sr.name.replace(' ', '-') }}">{{ sr.name }}</a>
          </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}
        {% if individuals %}
        <a class="to-indv-varieties" href="#individual-varieties">Individual {{ cn.name }} Varieties</a>
        {% endif %}
      </div>
      {% endif %}
      {% if subtypes %}
        {% for st in subtypes %}
          {% if st.has_public_cultivars or current_user.can(Permission.MANAGE_SEEDS) %}
      <div class="cn-group-header cn-subtype-header">
        <h2 id="subtype-{{ st.slug }}">{{ st.name }}</h2>
            {% if st.description %}
        <div class="description">{{ st.description|safe }}</div>
            {% endif %}
            {% if st.instructions %}
        <a class="instructions-link" href="#{{ st.slug }}-instructions">Planting Instructions for {{ st.name }}</a>
            {% endif %}
      </div>
      <div class="cultivar-group cn-subtype-cultivars">
            {% for cv in st.cultivars %}
        {{ cultivar_box(cv)|indent(8)|safe }}
            {% endfor %}
      </div>
            {% if st.instructions %}
      <div class="instructions" id="{{ st.slug }}-instructions">{{ st.instructions|safe }}</div>
            {% endif %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% if series %}
        {% for sr in series %}
          {% if sr.has_public_cultivars or current_user.can(Permission.MANAGE_SEEDS) %}
      <div class="cn-group-header cn-series-header">
        <h2 id="series-{{ sr.name.replace(' ', '-') }}">{{ sr.name }} Series</h2>
        <em>{{ cn.header }}</em>
            {% if sr.description %}
        <div class="description">{{ sr.description|safe }}</div>
            {% endif %}
      </div>
      <div class="cultivar-group cn-series-cultivars">
            {% for cv in sr.cultivars %}
        {{ cultivar_box(cv)|indent(8)|safe }}
            {% endfor %}
      </div>
          {% endif %}
        {% endfor %}
      {% endif %}
      {% if individuals %}
        {% if subcategories or series %}
      <div class="cn-group-header cn-individuals-header">
        <h2 id="individual-varieties">Individual {{ cn.name }} Varieties</h2>
        <a class="to-planting-instructions" href="#{{ cn.slug }}-instructions">How to plant {{ cn.name }} seeds</a>
      </div>
        {% endif %}
      <div class="cultivar-group cn-individual-cultivars">
        {% for cv in individuals %}
        {{ cultivar_box(cv)|indent(8)|safe }}
        {% endfor %}
      </div>
      {% endif %}
      {% if cn.instructions %}
      <div id="{{ cn.slug }}-instructions" class="planting-instructions">
        <h2>How to Plant {{ cn.name }} Seeds</h2>
        {{ cn.instructions|indent(6)|safe }}
      </div>
      {% endif %}
{% endblock %}
